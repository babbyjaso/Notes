- Static analysis involves looking at it, now it's time to let it run
	- Gives us the best overview for our Host and Network indicators
- Basic Analysis ^dyn-bas
	- Host Indicators ^host
		- establishing persistence
		- deletes/creates files
		- etc.
	- Network indicators ^network
		- calls to a domain
		- downloads a file
		- etc.
	- Make sure your tools are up
		- inetsim
		- wireshark
		- [[ProcMon]]
	- Can make inferences as to the activity of the malware based on static analysis
		- See the URLs contacted during your analysis?
		- Filter them in Wireshark to see just that traffic
		- see those API calls?
		- Filter in procmon to see them
	- Tricking the malware
		- what if a piece of malware is looking for a DNS resolution, but can't find it?
			- let's just give it one
			- change your lab's DNS by changing the hosts file
			- `nano C:\Windows\System32\drivers\etc\hosts`
			- assign the domain to your box
				- `127.0.0.1 [domain]` 
			- now we can see what it's trying to do when it connects
				- use [[ProcMon]] to monitor the callout
				- use [[TCPview]] to see what port
- Advanced Analysis ^dyn-adv
	- Debugger
		- When a program is run it goes through steps that are in the code
		- a debugger allows you to control those steps
		- used in software engineering as well as malware analysis
	- Tools:\
		- [[Process Hacker 2]]
		- [[x*dbg]]
- After you launch malware, always revert
	- Take your notes outside of your VM lol
	- in your notes
		- write down your hashes
		- write down urls seen
			- [[FLOSS]]
			- [[PEstudio]]
		- write down your windows api calls
			- [[PEstudio]]
		- write down host indicators
			- [[ProcMon]]
		- write down network indicators
			- Wireshark
			- [[ProcMon]]
		- build on what the program does and in what order from your observations
- Anti-analysis Techniques ^anti-analysis
	- ranges from obfuscation to recognizing if it's in a sandbox/debugger/FlareVM
	- As simple as a [[Windows API]] call
		- [IsDebuggerPresent](https://learn.microsoft.com/en-us/windows/win32/api/debugapi/nf-debugapi-isdebuggerpresent)
	- This is where the `test` function can come into play
		- because the output of the debugger is either 0 or 1, you can use a [bitwise AND](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_AND) to set a flag and jump to a different part of the malware all together
		- after you do this test, set the `AL` bytes to 0 using `setne`
			- will assign the `AL` bytes to 0 because the previous `test` triggered a flag
		- Now that it's been set,we can `je` or `jne` around
	- getting around this using [[x*dbg]]
		- Right Click > Search For > All Modules > String References
			- This brings up all the string modules
			- set a breakpoint where you see the `IsDebuggerPresent` string is referenced
			- put a breakpoint when you hit the return `ret`
			- put a breakpoint where the `test` is
	- we get to where it has no `zf` and then flip it in dbg
	- continue on to have the debugger result be flipped